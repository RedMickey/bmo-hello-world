# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger: none
pr: none

pool:
  vmImage: ubuntu-latest

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '12.x'
    displayName: 'Install Node.js'

  - bash: npm install ovsx vsce -g --force
    displayName: "npm install ovsx vsce -g"

  - bash: npm ci
    displayName: "npm ci"

  - bash: npm run compile
    displayName: "npm run compile"
  
  - bash: vsce package
    displayName: "vsce package"

  - bash: |
      VSIX=`ls *.vsix`
      ovsx publish $VSIX -p $(publishPAT)
    displayName: "ovsx publish"
    condition: and(succeeded(), eq(variables['dryrun'], 'false'))
